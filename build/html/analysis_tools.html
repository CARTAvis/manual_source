

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Image cube analysis tools &#8212; CARTA 1.3 documentation</title>
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Appendix A: version history" href="appendix_a_version_history.html" />
    <link rel="prev" title="Image cube visualization" href="image_visualization.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="appendix_a_version_history.html" title="Appendix A: version history"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="image_visualization.html" title="Image cube visualization"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CARTA 1.3 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/carta_logo_v2.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Image cube analysis tools</a><ul>
<li><a class="reference internal" href="#region-of-interest">Region of interest</a></li>
<li><a class="reference internal" href="#spatial-profiler">Spatial profiler</a></li>
<li><a class="reference internal" href="#spectral-profiler">Spectral profiler</a></li>
<li><a class="reference internal" href="#stokes-analysis-widget">Stokes analysis widget</a></li>
<li><a class="reference internal" href="#statistics-widget">Statistics widget</a></li>
<li><a class="reference internal" href="#histogram-widget">Histogram widget</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="image_visualization.html"
                        title="previous chapter">Image cube visualization</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="appendix_a_version_history.html"
                        title="next chapter">Appendix A: version history</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/analysis_tools.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="image-cube-analysis-tools">
<h1>Image cube analysis tools<a class="headerlink" href="#image-cube-analysis-tools" title="Permalink to this headline">¶</a></h1>
<p>With version 1.3, CARTA provides the following widgets for image cube analysis:</p>
<ul class="simple">
<li><p>Widget</p>
<ul>
<li><p>region list: to view and configure region properties</p></li>
<li><p>spatial profiler: to view x and y spatial profiles at the cursor position</p></li>
<li><p>spectral profiler: to view spectral profile from a region of interest</p></li>
<li><p>histogram: to view histogram from a region of interest</p></li>
<li><p>statistics: to view basic statistics from a region of interest</p></li>
<li><p>Stokes analysis: to view basic polarization quantities</p></li>
</ul>
</li>
</ul>
<div class="section" id="region-of-interest">
<h2>Region of interest<a class="headerlink" href="#region-of-interest" title="Permalink to this headline">¶</a></h2>
<p>As of v1.3, CARTA supports the following region types:</p>
<ul class="simple">
<li><p>rectangle (rotatable)</p></li>
<li><p>ellipse (rotatable)</p></li>
<li><p>square (rotatable; as a special case of rectangle; “<strong>shift</strong>” key + drag)</p></li>
<li><p>circle (as a special case of ellipse; “<strong>shift</strong>” key + drag)</p></li>
<li><p>point</p></li>
<li><p>polygon</p></li>
</ul>
<p>The creation and modification of regions are demonstrated in the section <a class="reference internal" href="about_gui.html#mouse-interaction-with-regions"><span class="std std-ref">Mouse interactions with region of interest</span></a>. To create a region, use the region button at the bottom-right corner of the image viewer, then use cursor to draw a region. CARTA allows regions to be created even if the region is outside the image. Keyboard shortcuts associated with regions are listed below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 31%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>macOS</p></th>
<th class="head"><p>Linux</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Region properties</p></td>
<td><p>double-click</p></td>
<td><p>double-click</p></td>
</tr>
<tr class="row-odd"><td><p>Delete selected region</p></td>
<td><p>del / backspace</p></td>
<td><p>del / backspace</p></td>
</tr>
<tr class="row-even"><td><p>Toggle region creation mode</p></td>
<td><p>C</p></td>
<td><p>C</p></td>
</tr>
<tr class="row-odd"><td><p>Deselect region</p></td>
<td><p>esc</p></td>
<td><p>esc</p></td>
</tr>
<tr class="row-even"><td><p>Switch region creation mode</p></td>
<td><p>cmd + drag</p></td>
<td><p>ctrl + drag</p></td>
</tr>
<tr class="row-odd"><td><p>Symmetric region creation</p></td>
<td><p>shift + drag</p></td>
<td><p>shift + drag</p></td>
</tr>
<tr class="row-even"><td><p>Pan image (inside region)</p></td>
<td><p>cmd + click / middle-click</p></td>
<td><p>ctrl + click / middle-click</p></td>
</tr>
<tr class="row-odd"><td><p>Toggle current region lock</p></td>
<td><p>L</p></td>
<td><p>L</p></td>
</tr>
<tr class="row-even"><td><p>Unlock all regions</p></td>
<td><p>shift + L</p></td>
<td><p>shift + L</p></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>“<strong>backspace</strong>” does not delete a region…</p>
<p>If using CARTA remote mode in Firefox on MacOS, you may find the “<strong>backspace</strong>” key navigates back a page instead of removing a region. This behaviour can be prevented by modifying your Firefox web browser settings:</p>
<ol class="arabic simple">
<li><p>Enter <a class="reference external" href="about:config">about:config</a> in the address bar.</p></li>
<li><p>Click “I accept the risk!”</p></li>
<li><p>A search bar appears at the top of a long list of preferences. Search for “browser.backspace_action”</p></li>
<li><p>It will likely have a value of 0. Double click it, and then modify it to a value of “2”.</p></li>
<li><p>Close the <a class="reference external" href="about:config">about:config</a> tab and now backspace will no longer navigate back a page.</p></li>
</ol>
</div>
<p>All created regions are listed in the region list widget with basic region properties. To select a region (region state changes to “selected”), simply click on the region in the image viewer, or click on the region in the region list widget. To modify the properties of a selected region, double-click on a region in the image viewer or a region in the region list widget. The color, line style, name, location, and shape, of a region are all configurable with the region property dialogue. To de-select a region, press “<strong>esc</strong>” key. To delete a selected region, press “<strong>delete</strong>” or “<strong>backspace</strong>” key. The activated region can be locked by pressing “<strong>L</strong>” key or by clicking the “lock” icon in the region list widget or region property dialogue. When a region is locked, it cannot be modified (resize, move, or delete) with mouse actions and the “<strong>delete</strong>” or “<strong>backspace</strong>” key. A locked region, however, can still be modified or delected via the region property dialogue. Locking a region could help the stituation when users want to modify overlapping regions, or could prevent modifying a region accidentally. The “eye” icon is to show the corresponding region at the center of image view.</p>
<img src="_static/carta_fn_roi.png"
     style="width:100%;height:auto;"><p>CARTA checks if a polygon is simple or complex. If a polygon is detected as complex, its color will be in pink as a warning. Spectral profile, statistics, or histogram of a complex polygon can still be requested. However, the outcome may be beyond users’ expectation. The enclosed pixels depend on <em>how</em> a complex polygon is constructed. Please use complex polygon with caution.</p>
<p>Region of interest enables practical image cube analysis through statistics, histogram, and spectral profiler widgets. When a region is selected, the region associated widgets will be highlighted with a persistent blue box as demonstrated below.</p>
<video controls loop style="width:100%;height:auto;">
  <source src="_static/carta_fn_roi_widgetHighlight.mp4" type="video/mp4">
</video><p>As of v1.3, CARTA supports basic region import and export capability. Regions, in world coordinate or in image coordinate, can be exported to a text file or imported from a text file. To import a region file, use the menu <strong>File</strong> -&gt; <strong>Import regions</strong>.</p>
<img src="_static/carta_fn_regionImport.png"
     style="width:100%;height:auto;"><p>To export regions to a region file, use the meun <strong>File</strong> -&gt; <strong>Export regions</strong>. All regions, except cursor, will be exported.</p>
<img src="_static/carta_fn_regionExport.png"
     style="width:100%;height:auto;"><p>As of v1.3, CASA region text format (.crtf) and ds9 region text formate (.reg) are supported with some limitations. Currently only the 2D region defination is supported. Other properties, such as spectral range, reference frame, or decoration (line style, line width, etc.) will be supported in future releases.</p>
<p>The currently supported CRTF region syntax is summerized below:</p>
<ul class="simple">
<li><p>Rectangle</p>
<ul>
<li><p>box[[x1, y1], [x2, y2]]</p></li>
<li><p>centerbox[[x, y], [x_width, y_width]]</p></li>
<li><p>rotbox[[x, y], [x_width, y_width], rotang]</p></li>
</ul>
</li>
<li><p>Ellipse</p>
<ul>
<li><p>circle[[x, y], r]</p></li>
<li><p>ellipse[[x, y], [bmaj, bmin], pa]</p></li>
</ul>
</li>
<li><p>Polygon</p>
<ul>
<li><p>poly[[x1, y1], [x2, y2], [x3, y3], …]</p></li>
</ul>
</li>
<li><p>Point</p>
<ul>
<li><p>symbol[[x, y], .]</p></li>
</ul>
</li>
</ul>
<p>Please refer to <a class="reference external" href="https://casa.nrao.edu/casadocs/casa-5.6.0/imaging/image-analysis/region-file-format">https://casa.nrao.edu/casadocs/casa-5.6.0/imaging/image-analysis/region-file-format</a> for more detailed descriptions about the CRTF syntax.</p>
<p>The currently supported ds9 region syntax is summerized below:</p>
<ul class="simple">
<li><p>Rectangle</p>
<ul>
<li><p>box x y width height angle</p></li>
</ul>
</li>
<li><p>Ellipse</p>
<ul>
<li><p>ellipse x y radius radius angle</p></li>
<li><p>circle x y radius</p></li>
</ul>
</li>
<li><p>Polygon</p>
<ul>
<li><p>polygon x1 y1 x2 y2 x3 y3 …</p></li>
</ul>
</li>
<li><p>Point</p>
<ul>
<li><p>point x y</p></li>
</ul>
</li>
</ul>
<p>Please refer to <a class="reference external" href="http://ds9.si.edu/doc/ref/region.html">http://ds9.si.edu/doc/ref/region.html</a> for more detailed descriptions about the ds9 region syntax.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In v1.3, region is registered to individual image (just like v1.2) even if the image is matched to other images in world coordinates. This limitation will be removed in v1.4, so that users can request analytics data from <em>all</em> matched images in the same region.</p>
</div>
</div>
<div class="section" id="spatial-profiler">
<h2>Spatial profiler<a class="headerlink" href="#spatial-profiler" title="Permalink to this headline">¶</a></h2>
<p>Spatial profiler provides the spatial profiles of the current image at the cursor position. When the cursor is moving on the image, profiles derived from the full resolution raster image are displayed. The “F” key will disable or enable profile update. When cursor update is disabled, a marker “+” will be placed on the image to indicate the position of the profiles taken.</p>
<p>When displaying a spatial profile with the number of pixels more than the number of screen pixels of the spatial profiler widget, a <em>decimated</em> profile will be derived and displayed to users as an enhancement of performance. Min/max decimation of a profile is adopted to ensure profile features are preserved. In other words, positive and negative peaks should stay at the same screen pixels just like displaying the full resolution profile. When users keep zooming in the profile, decimation with narrower and narrower interval is applied dynamically. Full resolution profile is displayed when the number of screen pixels is more than the number of pixels of the profile to be displayed.</p>
<p>The interactions of the spatial profiler widget are demonstrated in the section <a class="reference internal" href="about_gui.html#mouse-interaction-with-charts"><span class="std std-ref">Mouse interactions with charts</span></a>. The red vertical bar indicates the pixel where the profile is taken. The bottom axis shows the image coordinate, while optional world coordinate is displayed on the top axis. Extra options to configure the profile plot are available in the spatial profiler settings dialogue which is launched by clicking the “cog” icon at the top-right corner. The option “Show Mean/RMS” will adopt the data in the current view to derive a mean value and an rms value, and visualize the results on the plot. Numerical values are also displayed at the bottom-left corner. The profile can be exported as a png image or a text file in tsv format via the buttons at the bottom-right corner.</p>
<p>When the cursor is on the image in the image viewer, the pointed pixel value (pixel index and pixel value) will be displayed at the bottom-left corner of the spatial profiler. When the cursor is on the spatial profiler graph, the pointed profile data will be displayed instead.</p>
<img src="_static/carta_fn_spatialProfiler_widget.png"
     style="width:100%;height:auto;"><div class="admonition note">
<p class="admonition-title">Note</p>
<p>In future release, the following features will be supported:</p>
<ul class="simple">
<li><p>More flexibilities on how mean and rms values are derived in the plot</p></li>
<li><p>Profile fitting capability</p></li>
<li><p>Profile along a line segment, polyline, or an arbitary curve</p></li>
</ul>
</div>
</div>
<div class="section" id="spectral-profiler">
<h2>Spectral profiler<a class="headerlink" href="#spectral-profiler" title="Permalink to this headline">¶</a></h2>
<p>Spectral profiler provides the spectral profile of the current image cube at the selected region. The default region is set to “Cursor”. The “<strong>F</strong>” key will disable or enable cursor profile update. When cursor update is disabled, a marker “+” will be placed on the image to indicate the position of the profile taken.</p>
<p>When requesting a spectral profile, a common disappointing user experience is that users may have to wait for an unknown amount of time to see the final result if the image cube is large. As an improvement on this aspect, CARTA supports <em>progressive update</em> of spectral profile. Partial profiles will be periodically delivered to users while the full profile calculations are still ongoing.</p>
<video controls loop style="width:100%;height:auto;">
  <source src="_static/carta_fn_spectralProfiler_partialUpdate.mp4" type="video/mp4">
</video><p>When the property of a region (cursor or a regular region) is modified while the profile of the original region is being updated, the partial profile will disappear and a new partial profile cooresponding to the new region will start updating. If users modify the request of a spectral profile via the spectral profile widget before it is fully delivered, the original profile calculations will be cancelled and new profile calculations will start. In short, now CARTA should just focus on calculating and showing the profiles that users pay attention to. If a profile is no longer needed to be shown on the screen, the profile calculation will be cancelled immediately, instead of blocking and queueing up new profile requests.</p>
<video controls loop style="width:100%;height:auto;">
  <source src="_static/carta_fn_spectralProfiler_profileCancellation.mp4" type="video/mp4">
</video><p>When displaying a spectral profile with the number of channels more than the number of screen pixels of the spectral profiler widget, a <em>decimated</em> profile will be derived and displayed to users as an enhancement of performance. Min/max decimation of a profile is adopted to ensure profile features are preserved. In other words, positive and negative peaks should stay at the same screen pixels just like displaying the full resolution profile. When users keep zooming in the profile, decimation with narrower and narrower interval is applied dynamically. Full resolution profile is displayed when the number of screen pixels is more than the number of pixels of the profile to be displayed.</p>
<p>When regions are created, the spectral profiler widget can be configured to display a profile from a specific region with the “<em>region</em>” dropdown menu. The default of the “<em>region</em>” dropdown is “Active” which points to the current active (selected) region. If no region is active, it defaults to cursor region. Additional statistic types to compute the region spectral profile are available with the “<em>statistic</em>” dropdown menu (default to mean). If the image cube has multiple Stokes, the “<em>Stokes</em>” dropdown menu will be activated and defaulted to “current” which is synchronized with the selection in the animator. To view a specific Stokes, select with the “<em>Stokes</em>” dropdown menu.</p>
<p>Multiple spectral profile widgets can be configured to display different region spectral profiles. The widget with the selected region will be highlighted with a persistent blue box.</p>
<img src="_static/carta_fn_spectralProfiler_multiwidget.png"
     style="width:100%;height:auto;"><p>The interactions of the spectral profiler widget are demonstrated in the section <a class="reference internal" href="about_gui.html#mouse-interaction-with-charts"><span class="std std-ref">Mouse interactions with charts</span></a>. The red vertical bar indicates the channel of the image displayed in the image viewer. Clicking directly on the spectral profiler graph will change the displayed image to the clicked channel. Alternatively, the red vertical bar is draggable and acts just like the animator slider.</p>
<p>The bottom axis shows the spectral coordinate, Extra options to configure the profile plot are available in the spectral profile settings dialogue which can be launched by clicking the “cog” icon in the top-right corner. In the dialogue, users may select a different spectral convention (e.g., optical velocity) and a different reference system (e.g., TOPO). The option “Show Mean/RMS” will adopt the data in the current view to derive a mean value and an rms value, and visualize the results on the plot. Numerical values are also displayed at the bottom-left corner. When the cursor is on the image in the image viewer, the pointed pixel value (frequency or velocity or channel index, and pixel value) will be displayed at the bottom-left corner of the spectral profiler. When the cursor is on the spectral profiler graph, the pointed profile data will be displayed instead. The profile can be exported as a png image or a text file in tsv format via the buttons at the bottom-right corner.</p>
<img src="_static/carta_fn_spectralProfiler_widget.png"
     style="width:100%;height:auto;"><div class="admonition note">
<p class="admonition-title">Note</p>
<p>In future releases, the follow features will be supported:</p>
<ul class="simple">
<li><p>More flexibilities on how mean and rms values are derived</p></li>
<li><p>Profile fitting</p></li>
<li><p>Line identification toolkit</p></li>
<li><p>Intensity unit conversion</p></li>
</ul>
</div>
</div>
<div class="section" id="stokes-analysis-widget">
<h2>Stokes analysis widget<a class="headerlink" href="#stokes-analysis-widget" title="Permalink to this headline">¶</a></h2>
<p>Stokes analysis widget allows users to view basic polarization quantities of a multi-channel (number of channel &gt; 1), multi-Stokes (IQU or IQUV) cube efficiently. The widget includes the following plots:</p>
<ul class="simple">
<li><p>Stokes Q intensity and Stokes U intensity over the spectral axis</p></li>
<li><p>Linearly polarized intensity over the spectral axis</p></li>
<li><p>Linear polarization angle over the spectral axis</p></li>
<li><p>Stokes Q intensity versus Stokes U intensity</p></li>
</ul>
<p>The profiles can be zoomed and panned with mouse similar to the spatial profile widget or the  spectral profile widget (<a class="reference internal" href="about_gui.html#mouse-interaction-with-charts"><span class="std std-ref">Mouse interactions with charts</span></a>). The Stokes Q versus Stokes U scatter plot is color-encoded from red to blue with increasing frequencies. The profiles can be requested at the cursor position (single pixel) or over a region of interest. Fractional polarization quantities are also supported. Examples are given in the following figures. The first one is from real ALMA data, while the second one is from an artifical Stokes cube.</p>
<img src="_static/carta_fn_Stokes_widget.png"
     style="width:100%;height:auto;"><img src="_static/carta_fn_Stokes_widget2.png"
     style="width:100%;height:auto;"><p>When profiles are zoomed, the scatter plot will highlight those channels remaining in the profile view. Similarly, when scatter plot is zoomed, the profile plot will highlight those channels remaining in the scatter plot view.</p>
<video controls loop style="width:100%;height:auto;">
  <source src="_static/carta_fn_stokesLinkedPlot.mp4" type="video/mp4">
</video><p>Additional options to customize the plots in the Stokes analysis widget are provided in the settings dialogue which can be launched by clicking the “cog” icon at the top-right corner.</p>
<img src="_static/carta_fn_Stokes_settings.png"
     style="width:100%;height:auto;"></div>
<div class="section" id="statistics-widget">
<h2>Statistics widget<a class="headerlink" href="#statistics-widget" title="Permalink to this headline">¶</a></h2>
<p>Statistics widget allows users to see statistics with respect to a selected region. The “Region” dropdown menu can be used to select which region statistics to be displayed. The default is “Active” which means the current active (selected) region. If no region is active, it defaults to the entire image of the displayed channel to compute statistics. Multiple statistics widgets can be created to display statistics of different regions as demonstrated below. The widget with the selected region will be highlighted with a persistent blue box.</p>
<img src="_static/carta_fn_statistics_widget.png"
     style="width:100%;height:auto;"></div>
<div class="section" id="histogram-widget">
<h2>Histogram widget<a class="headerlink" href="#histogram-widget" title="Permalink to this headline">¶</a></h2>
<p>Histogram widget allows users to visualize data in a histogram with respect to a selected region. The “Region” dropdown menu can be used to select which region histogram to be displayed. The default is “Active” which means the current active (selected) region. If no region is active, it defaults to the entire image of the displayed channel to construct a histogram. Multiple histogram widgets can be created to display histograms of different regions as demonstrated below. The widget with the selected region will be highlighted with a persistent blue box.</p>
<img src="_static/carta_fn_histogram_widget.png"
     style="width:100%;height:auto;"><p>Additional options to customize the histogram in the histogram widget are provided in the settings dialogue which can be launched by clicking the “cog” icon at the top-right corner.</p>
<img src="_static/carta_fn_histogram_settings.png"
     style="width:100%;height:auto;"><div class="admonition note">
<p class="admonition-title">Note</p>
<p>With v1.3, histogram bin width and bin count are automatically decided. Enhancement of the histogram widget, including histogram fitting, will be available in future releases.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="appendix_a_version_history.html" title="Appendix A: version history"
             >next</a></li>
        <li class="right" >
          <a href="image_visualization.html" title="Image cube visualization"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CARTA 1.3 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018-2020, ASIAA, IDIA, NRAO, and Department of Physics, University of Alberta.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>