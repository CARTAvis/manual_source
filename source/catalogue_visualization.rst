.. _catalog_widget:

Catalog visualization
=======================
Source catalog files in *VOTable* or *FITS* format can be loaded in CARTA (via **File** -> **Import catalog**) for visualization as an image overlay, or a 2D scatter plot, or a histogram. Once a source catalog file is loaded, the information of each column will be shown in the upper table, while the actual catalog entries are displayed in the lower table. By default, only the first 10 columns are enabled and displayed. Users may configure it to show or hide certain columns to be displayed in the lower table. 

.. raw:: html

   <img src="_static/carta_fn_catalogue_widget.png" 
        style="width:100%;height:auto;">

When the rendering type is "Image overlay", a coordinate system of the source catalog needs to be defined via the "System" dropdown menu. CARTA tries to obtain the coordinate system information from the header of the catalog file. If this process is not possible, you need to set it manually in order to make the interpretation of the world coordinates correctly. Source catalog defined in the image coordinate (0-based or 1-based) is also supported.

Multiple catalog files can be loaded and you may use the "File" dropdown at the top of the widget to switch in between. Multiple catalog widgets may be launched to display different catalog files. The "Close" button at the bottom of the widget will close the selected catalog file in the "File" dropdown. If there are spatially matched images, the catalog overlay on the reference image will be shared to other images by applying proper coordinate transformations.


Catalog filtering
-------------------
The source catalog table accepts sub-filters such as partial string match or value range. For numeric columns, supported operators are:

* :code:`>` : greater than
* :code:`>=` : greater than or equal to
* :code:`<` : less than
* :code:`<=` : less than or equal to
* :code:`==` : equal to
* :code:`!=` : not equal to
* :code:`..` : between (exclusive)
* :code:`...` : between (inclusive)
                    
For examples:

* to filter everything less than 10, use :code:`< 10`
* to filter entries equal to 1.23, use :code:`== 1.23`
* to filter everything between 10 and 50 (exclusive), use :code:`10..50`
* to filter everything between 10 and 50 (inclusive), use :code:`10...50`

For string columns, partial match is adopted. For example, :code:`gal` (no quotation) will return entries containing the "gal" string.

Once filters are set, by clicking the "Update" button, the filters will be applied and a filtered source catalog will be displayed up to a number of entries defined in the "Max Rows" text input field. When the "Reset" button is clicked, all filters will be removed and the image overlay (if exists) will be removed too. For the histogram plot or the 2D scatter plot, the plot will be reset so that only the first (up to) 50 entries are rendered.


Catalog image overlay
---------------------
CARTA supports flexible catalog image overlay with variable marker size, color, and orientation. A catalog image overlay can be generated by using the dropdown menus at the bottom of the catalog widget. The rendering type is "image overlay" and two data columns need to be identified as the world coordinates. Once they are configured properly, you can click the "Plot" button to generate the catalog overlay on the image.

In the example below, a catalog is loaded and displayed in the Catalog widget. The rendering type is selected as "Image Overlay" and the "RA_d" and the "DEC_d" columns are identified as source world  coordinates in the ICRS system. A filter is applied to the "ANG_DIST" column, resulting in 638 filtered sources. These sources are rendered on the image as cyan circles. 

.. raw:: html

   <img src="_static/carta_fn_catalogue_widget_filter.png" 
        style="width:100%;height:auto;">


The size, color, and orientation properties of the marker can be adjusted via the catalog settings dialog. The shortcut buttons are available at the top-right corner of the widget. 

.. raw:: html

   <img src="_static/carta_fn_catalogue_widget_marker_options.png" 
        style="width:100%;height:auto;">

With the "Size", "Color", and "Orientation" tabs, you can create a catalog overlay with a uniform color, a uniform size, and a uniform orientation. Or, each of the maker properties can be mapped to a data column with a scaling function and clip bounds so that the marker property becomes variable. In the following example, an ellipse marker is used to generate the catalog overlay. Its color, size, and orientation are mapped to data columns. 

.. raw:: html

   <img src="_static/carta_fn_catalogue_widget_marker_mapping.png" 
        style="width:100%;height:auto;">


The catalog overlay and the catalog table in the catalog widget are inter-linked. For example, when you select a source on the image, the selected source will be highlighted in the image *and* in the catalog table, and vice versa. 

.. raw:: html

   <img src="_static/carta_fn_catalogue_widget_image_overlay_selection.png" 
        style="width:100%;height:auto;">


Catalog 2D scatter plot
-------------------------
The Catalog 2D scatter plot widget shows a 2D scatter plot of two numeric columns of a catalog file. The available numeric columns are determined by the "Display" column of the upper table in the Catalog widget. The data used for plotting the 2D scatter is determined by the lower table in the Catalog widget. The table may not show all entries due to the dynamic loading feature. Thus, the 2D scatter plot may not include all entries (after filtering). The "Plot" button will request a full download of all entries and the histogram plot will then include all entries (after filtering).

By clicking on a point or using the selection tools from the top-right corner of the plot, selected sources will be highlighted in the source catalog table, in the histogram plot (if exists), and in the image viewer (if the catalog overlay is enabled). Points on the plot will be highlighted if sources are selected in the source catalog table, in the histogram plot (if exists), and in the image viewer (if the catalog overlay is enabled). The "Selected only" toggle will update the source catalog table to show only the selected sources.

.. raw:: html

   <img src="_static/carta_fn_catalogue_widget_scatter.png" 
        style="width:70%;height:auto;">


Catalog histogram plot
------------------------
The Catalog histogram plot widget shows a histogram of one numeric column of a catalog file. The available numeric columns are determined by the "Display" column of the upper table in the Catalog widget. The data used for plotting the histogram is determined by the lower table in the Catalog widget. The table may not show all entries due to the dynamic loading feature. Thus, the histogram plot may not include all entries (after filtering). The "Plot All" button will request a full download of all entries and the histogram plot will then include all entries (after filtering). The number of bins and the scale of the y-axis can be customized.

By clicking on a certain histogram bin, source entries of that bin will be highlighted in the source catalog table, in the 2D scatter plot (if exists), and in the image viewer (if the catalog overlay is enabled). A certain histogram bin will be highlighted if source entries of that bin are selected in the source catalog table, in the 2D scatter plot (if exists), and in the image viewer (if the catalog overlay is enabled). The "Show only selected sources" toggle will update the source catalog table to show only the selected sources.


.. raw:: html

   <img src="_static/carta_fn_catalogue_widget_histogram.png" 
        style="width:70%;height:auto;">


Linked catalog visualization
------------------------------
The source catalog table, the image overlay, the 2D scatter plot, and the histogram plot are inter-linked or cross-referenced. This means, for example, selecting a source or a set of sources in the catalog table will trigger source highlight in other places. Or, selecting a source or a set of sources in the 2D scatter plot will trigger source highlight in other plots and in the catalogue table.

.. raw:: html

   <img src="_static/carta_fn_catalogue_widget_linked.png" 
        style="width:100%;height:auto;">

